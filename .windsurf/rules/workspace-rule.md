---
trigger: manual
---

### プロジェクト固有のワークスペースルール

#### 1. プロジェクト概要とゴール定義
- このプロジェクトは、Thunderbirdのブラウザ拡張機能として、ショートカット機能を追加するもの。
- ゴール: シンプルで高速な拡張機能を提供し、ユーザーのメール操作を効率化する。
- 制約: Thunderbird WebExtensions APIに準拠し、セキュリティを最優先（[SFT]）。
- 技術スタック: TypeScript, Biome, pnpm, Node.js。

#### 2. コード品質基準
- すべてのコードはBiomeの設定に準拠し、自動フォーマットを実行する。
- 関数は30行以内、ファイルは300行以内に保つ。
- ネストされた条件分岐は2段階以内に制限。
- クラスはパブリックメソッドを5つ以内に抑える。
- 重複コードは禁止し、再利用可能な関数やモジュールを優先。

#### 3. 依存管理とシンプルさ
- 新しいライブラリは明確な理由（例: パフォーマンス向上）がない限り追加しない。
- pnpmを使用し、package.jsonのバージョンは固定して安定性を確保。
- 外部APIを使用する場合、APIキーは環境変数で管理し、ハードコーディング禁止。

#### 4. エラーハンドリングとセキュリティ
- すべての外部入力（例: ユーザー設定、APIレスポンス）は検証する。
- 非同期処理では適切なエラーハンドリングとリソース解放を行う。
- 拡張機能の権限は最小限に抑え、manifest.jsonで明示的に宣言。

#### 5. ドキュメントとコミュニケーション
- 複雑なロジックのみコメントし、明白な内容はドキュメント化しない。
- 新しいドキュメントは英語で書く（README.mdなど既存のものを参考）。

#### 6. ワークフローとコミット
- 変更は小さく自己完結したものに分け、定期的にコミット。
- コミットメッセージフォーマット:
  ```
  type(scope): concise description

  [optional body with details]

  [optional footer with breaking changes/issue references]
  ```
  Types: feat, fix, docs, style, refactor, perf, test, chore.
- プッシュ前にBiomeとTypeScriptのチェックを実行。

#### 7. テストとデバッグ
- すべての機能はテストしやすいように設計。
- デバッグ時はログを追加し、仮説検証を繰り返す。
- エッジケースをカバーしたテストケースを作成。

#### 8. 進捗管理とメモリ
- TASK_LIST.mdやREADME.mdを常に最新に保つ。
- 重要なコンテキストはメモリ機能で保存（例: ユーザーの好みや技術スタック）。

#### 9. 代替アプローチとフィードバック
- 必要に応じて代替実装を提案（例: ライブラリ選択の長所/短所）。
- 中間結果を共有し、ユーザーのフィードバックを取り込む。

#### 10. 実装レポート
- 変更完了後は要約を報告し、改善点を提案。